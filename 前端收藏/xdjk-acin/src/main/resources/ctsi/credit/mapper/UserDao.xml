<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ctsi.credit.mapper.UserDao">

    <!--<resultMap type="User" id="UserResult">-->
    <!--<result property="id" column="id"/>-->
    <!--<result property="userName" column="user_name"/>-->
    <!--<result property="user_pwd" column="user_pwd"/>-->
    <!--<result property="role_name" column="role_name"/>-->
    <!--<result property="user_id" column="user_id"/>-->
    <!--</resultMap>-->

    <select id="login" parameterType="com.ctsi.credit.entity.User" resultType="com.ctsi.credit.entity.User">
        select * from
        ssm_user where user_name=#{user_name} and user_pwd=#{user_pwd} limit 1
    </select>

    <select id="getPowerList" parameterType="String" resultType="com.ctsi.credit.entity.User">
        select * from
        ssm_role_area_jurisdiction
        where id=#{id}
    </select>

    <select id="selectUsers" parameterType="java.util.HashMap" resultType="com.ctsi.credit.entity.User">
        SELECT
            *
        FROM
            ssm_user s,
            ssm_user_area ua,
            ssm_area a,
            ssm_role r
        WHERE
            s.id = ua.user_id
        AND  ua.area_id=a.id
        and a.area = #{area,jdbcType=VARCHAR}
        and r.role_number &gt; #{role_number,jdbcType=VARCHAR}
        group by s.id
    </select>

    <select id="selectRoleByUser" parameterType="string" resultType="com.ctsi.credit.entity.RolePermissions">
            SELECT
                *
            FROM
                (
                    SELECT
                        a.id,
                        b.role_name,
                        a.area_id,
                        c.area
                    FROM
                        ssm_role_area_jurisdiction a,
                        ssm_role b,
                        ssm_area c
                    WHERE
                        a.role_number = b.role_number and c.id = a.area_id
                ) c
            where c.id = #{userid};
    </select>

    <!--select * from (select a.id,b.role_number,a.area  from ssm_role_area_jurisdiction a,ssm_role b where a.role_number = b.role_number) c where c.id = #{userid};-->

    <select id="selectRoleByUser_roleid" parameterType="string" resultType="com.ctsi.credit.entity.RolePermissions">
            SELECT
                    *
                FROM
                    (
                        SELECT
                            a.id,
                            b.role_number,
                            b.role_name,
                            a.area_id,
                            c.area
                        FROM
                            ssm_role_area_jurisdiction a,
                            ssm_role b,
                            ssm_area c
                        WHERE
                            a.role_number = b.role_number and c.id = a.area_id
                    ) c
                WHERE
                    c.id = #{userid};
    </select>

    <select id="getAreaSelect" parameterType="string" resultType="com.ctsi.credit.entity.Area">
       select * from ssm_area where id in (select area_id from ssm_user_area where user_id = #{userid});
    </select>

    <!--select * from ssm_role where id in (select role_id from ssm_user_role where user_id =  #{userid});-->
    <select id="getRoleSelect" parameterType="string" resultType="com.ctsi.credit.entity.Role">
        SELECT
            role_name,role_number
        FROM
            ssm_role
        WHERE
            role_number > (
                SELECT
                distinct s.role_number
                FROM
                    ssm_role_area_jurisdiction s,
                    ssm_user u
                WHERE
                    s.id = u.id
                AND s.id = #{userid}
	        );
    </select>

    <select id="getUser" parameterType="string" resultType="com.ctsi.credit.entity.User">
  SELECT
        *
    FROM
        ssm_user
    WHERE
        id IN (
            SELECT
                id
            FROM
                ssm_role_area_jurisdiction
            WHERE
                role_number IN (
                    SELECT
                        role_number
                    FROM
                        ssm_role
                    WHERE
                        role_number >= (
                            SELECT DISTINCT
                                role_number
                            FROM
                                ssm_role_area_jurisdiction
                            WHERE
                                id = (
                                    SELECT
                                        id
                                    FROM
                                        ssm_user
                                    WHERE
                                        id = #{userid}
                                )
                        )
                )
        )
</select>

    <select id="getUserOne" parameterType="string" resultType="com.ctsi.credit.entity.User">
      select * from ssm_user where id =  #{userid};
    </select>


    <select id="setUser" parameterType="java.util.HashMap">
      UPDATE ssm_user set  email =  #{email,jdbcType=VARCHAR} WHERE  id = #{id,jdbcType=VARCHAR};
    </select>

    <select id="addRolePermissions" parameterType="java.util.HashMap">
      INSERT INTO ssm_role_area_jurisdiction (id,role_number,area_id) VALUES (#{id,jdbcType=VARCHAR},#{role_number,jdbcType=VARCHAR},#{area_id,jdbcType=VARCHAR});
    </select>

    <delete id="deleteRolesOfUser" parameterType="String">
      delete  from ssm_role_area_jurisdiction where id =  #{userid}
    </delete>

    <select id="addUser"  parameterType="com.ctsi.credit.entity.User">
      INSERT INTO ssm_user (id,user_name,user_pwd,email) VALUES (#{id},#{user_name},#{user_pwd},#{email});
    </select>
<!--INSERT INTO ssm_user_area (user_id,area_id) VALUES ( #{userid},#{area_id});-->
    <select id="addUserArea" parameterType="com.ctsi.credit.entity.User">

      INSERT INTO ssm_role_area_jurisdiction (id,role_number,area_id) VALUES ( #{id},#{role_number},#{area_id});
    </select>

    <select id="addUserRole" parameterType="com.ctsi.credit.entity.User">
      INSERT INTO ssm_user_role (user_id,role_id) VALUES ( #{userid},#{role_id});
    </select>

    <select id="selectAllUsers" resultType="com.ctsi.credit.entity.User">
      select * from ssm_user
    </select>

    <select id="getMenuForAreaRoleDao" parameterType="java.util.HashMap" resultType="com.ctsi.credit.entity.Menu">
      select * from ssm_menu where id in (select menu_id from ssm_role_menu where area_id = #{area_id} and role_number = #{role_number}) and parent_id != '0'
    </select>

    <select id="getParentId" parameterType="String" resultType="String">
      select m.id
      from ssm_menu m,ssm_area a
      where m.menu_name=a.area and a.id= #{area_id}
    </select>

    <select id="getParentMenuDao" parameterType="string" resultType="com.ctsi.credit.entity.Menu">
      select * from ssm_menu where menu_name = #{area,jdbcType=VARCHAR}
    </select>

    <select id="getSonMenuDao" parameterType="string" resultType="com.ctsi.credit.entity.Menu">
      select * from ssm_menu where parent_id = #{parent_id}
    </select>

    <select id="deleteRolesMenu" parameterType="java.util.HashMap" >
      delete  from  ssm_role_menu  where  role_number = #{role_number} and area_id = #{area_id} ;
    </select>

    <select id="selectMenuById" parameterType="java.util.HashMap" resultType="com.ctsi.credit.entity.Menu" >
      select * from ssm_menu where id = #{id}
    </select>

    <select id="insertPermission" parameterType="java.util.HashMap" >
      INSERT INTO ssm_role_menu (role_number,area_id,menu_id) VALUES ( #{role_number},#{area_id},#{menu_id});
    </select>
    <select id="selectBankId" parameterType="java.util.HashMap" resultType="com.ctsi.credit.entity.Menu"  >
      select * from ssm_menu where id = (select parent_id from ssm_menu where id = #{id})
    </select>
    <select id="insertBankPermission" parameterType="java.util.HashMap"  >
      INSERT INTO ssm_role_menu (role_number,area_id,menu_id) VALUES ( #{role_number},#{area_id},#{menu_id});
    </select>

    <select id="addUser_Area" parameterType="java.util.HashMap"  >
      INSERT INTO ssm_user_area (user_id,area_id) VALUES ( #{id},#{area_id});
    </select>

</mapper>
